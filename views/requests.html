{% extends "base.html" %}
{% block content %}
<!-- Get all requests -->
<script type="text/javascript" src="../js/request_actions.js"></script>
<script type="text/javascript" src="../js/create_request.js"></script>
<div id="user" name="user" value={{user.username}}></div>

<div class="row">
  <div class="col s12">
    <ul class="tabs">
      <li class="tab col s3" id="all_nav"><a class="active" href="#all">All</a></li>
      <li class="tab col s3"><a href="#accepted">Accepted</a></li>
      <li class="tab col s3" id="mine_nav"><a href="#mine">My Requests</a></li>
      <li class="tab col s3"><a href="#dead">Dead Requests</a></li>
    </ul>
  </div>

  <!-- All Requests -->
  <div id="all" class="col s12">
    <div class="row">
      <ul class="collection with-header col s12 m12">
        <br />
        {% for request in empty_requests %}
        {% if request.sender != user.key %}
        <li class="collection-item avatar">
          <img src ="http://cdn.wegotthiscovered.com/wp-content/uploads/hardwell-united-we-are-album-cover.jpg" class="circle">
          <span class="title"><b>Requestor:</b><a href="/foodie/{{request.sender_name}}"> {{request.sender_name}}</a></span>
          <p><b>Location:</b> {{request.location}} <br />
            <b>For:</b> {{request.start_time.date}} <br />
            <b> @ </b> {{request.start_time.time}}</p>
            <b>Food Type:</b> {{request.food_type}}</p>
            <b>Price Range:</b> ${{request.min_price}} to ${{request.max_price}}</p>
            <b>Interest:</b> {{request.interest}}</p>

          <div class="secondary-content">
            <!-- Uncomment and use JS to hide -->
            <button id="hide{{forloop.counter}}" style="border:none; background:none;" value={{request.key.urlsafe}}><i class="material-icons">thumb_down</i></button>
            <button id="confirm_modal{{forloop.counter}}" value={{request.key.urlsafe}} style="background:none; border:none;"><i class="material-icons">thumb_up</i></button>
          </div>
        </li>

        {% endif %}
        {% empty %}
        <li class="collection-header">
         <center>
          <h5>No Requests Yet</h5>
         </center>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Requests that have at least one attending -->
  <div id="accepted" class="col s12">
   <div class="row">
      <ul class="collection with-header col s12 m12">
        <br />
        {% for request in accepted_requests %}
        {% if request.sender != user.key %}
        <li class="collection-item avatar">
          <img src ="http://cdn.wegotthiscovered.com/wp-content/uploads/hardwell-united-we-are-album-cover.jpg" class="circle">
          <span class="title"><b>Requestor:</b><a href="/foodie/{{request.sender_name}}"> {{request.sender_name}}</a></span>
          <p><b>Location:</b> {{request.location}} <br />
            <b>For:</b> {{request.start_time.date}} <br />
            <b> @ </b> {{request.start_time.time}}</p>
            <p> <b>Attendees:</b> 
            {% for person in request.recipient_name %}
            <a href="/foodie/{{person}}">{{person}}</a>  
            {% endfor %}</p>
            <b>Food Type:</b> {{request.food_type}}</p>
            <b>Interest:</b> {{request.interest}}</p>
          <div class="secondary-content">
            <button id="cancel_request{{forloop.counter}}" style="border:none; background:none;" value={{request.key.urlsafe}}><i class="material-icons">cancel</i></button>
          </div>
        </li>
        {% endif %}
        {% empty %}
        <li class="collection-header">
         <center>
          <h5>No Accepted Requests</h5>
         </center>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- My Requests -->
  <div id="mine" class="col s12"> 
    <div class="row">
      <ul class="collection with-header col s12 m12">
      <br />
      {% for request in my_requests %}
        <li class="collection-item avatar">
          <img src ="http://cdn.wegotthiscovered.com/wp-content/uploads/hardwell-united-we-are-album-cover.jpg" class="circle">
          <span class="title"><b>Requestor:</b><a href="/foodie/{{request.sender_name}}"> {{request.sender_name}}</a></span>
          <p><b>Location:</b> {{request.location}} <br />
            <b>For:</b> {{request.start_time.date}} <br />
            <b> @ </b> {{request.start_time.time}}</p>
            {% if request.recipient_name|length > 0 %}
              <p> <b>Attendees:</b> 
              {% for person in request.recipient_name %}
              <a href="/foodie/{{person}}">{{person}}</a>  
              {% endfor %}</p>
            {% endif %}
            <b>Food Type:</b> {{request.food_type}}</p>
            <b>Price Range:</b> ${{request.min_price}} to ${{request.max_price}}</p>
            <b>Interest:</b> {{request.interest}}</p>
          <div class="secondary-content">
            <button id="delete{{forloop.counter}}" style="border:none; background:none;" value={{request.key.urlsafe}}><i class="material-icons">clear</i></button>
            <a href="/editrequest/{{request.key.urlsafe}}" style="border:none; background:none;"><i class="material-icons">mode_edit</i></a>
        </div>
        </li>
      {% empty %}
      <li class="collection-header">
       <center>
        <h5>No Requests</h5>
        <p>Find someone now!</p>
       </center>
      </li>
      {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Dead Requests -->
  <div id="dead" class="col s12">
    <div class="row">
      <ul class="collection with-header col s12 m12">
        <br />
        {% for request in dead_requests %}
        <li class="collection-item avatar">
          <img src ="http://cdn.wegotthiscovered.com/wp-content/uploads/hardwell-united-we-are-album-cover.jpg" class="circle">
          <span class="title"><b>Requestor:</b><a href="/foodie/{{request.sender_name}}"> {{request.sender_name}}</a></span>
          <p><b>Location:</b> {{request.location}} <br />
            <b>For:</b> {{request.start_time.date}} <br />
            <b> @ </b> {{request.start_time.time}}</p>
            {% if request.recipient_name|length > 0 %}
              <p> <b>Attendees:</b> 
              {% for person in request.recipient_name %}
              <a href="/foodie/{{person}}">{{person}}</a>  
              {% endfor %}</p>
            {% endif %}
            <b>Food Type:</b> {{request.food_type}}</p>
            <b>Price Range:</b> ${{request.min_price}} to ${{request.max_price}}</p>
            <b>Interest:</b> {{request.interest}}</p>
          <div class="secondary-content">
            <button id="delete{{forloop.counter}}" style="border:none; background:none;" value={{request.key.urlsafe}}><i class="material-icons">clear</i></button>
        </div>
        </li>
        {% empty %}
        <li class="collection-header">
         <center>
          <h5>No Dead Requests</h5>
         </center>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>
</div>

<!-- Respond Modal -->
<div id="respond" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4>Confirm Request</h4>
      <p> I agree to meet this person blah blah blah</p>
      <p> If I fail to appear, I accept the penalty of 50% of the agreed upon price. </p>
      <p> blah blah blah </b>
      <br />
    </div>
    <div class="modal-footer">
      <button id="accept_button" class="modal-action modal-close btn-flat" value={{request.key.urlsafe}} >Accept</button>
      <button type="cancel" id="close_modal" class="modal-action modal-close btn-flat">Cancel</button>
    </div>
</div>
{% endblock %}
